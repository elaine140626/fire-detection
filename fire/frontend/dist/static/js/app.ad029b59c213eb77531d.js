webpackJsonp([1],{"+kPp":function(e,t){},"1uuo":function(e,t){},"6Sxf":function(e,t){},Isj7:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("7+uW"),o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",{attrs:{id:"the-base-header"}},[n("el-row",{staticClass:"hidden-lg-and-up"},[n("h2",[e._v("\n      山大i-Learn智能烟火检测系统\n    ")])]),e._v(" "),n("el-row",{staticClass:"hidden-sm-and-down",attrs:{type:"flex",align:"middle"}},[n("el-col",{staticClass:"hidden-md-and-down",attrs:{span:14}},[n("h2",[e._v("\n        山大i-Learn智能烟火检测系统\n      ")])]),e._v(" "),n("el-col",{staticClass:"hidden-sm-and-down"},[n("el-button",{on:{click:function(t){return e.routeTo("overview")}}},[e._v("\n        系统总览\n      ")]),e._v(" "),n("el-button",{on:{click:function(t){return e.routeTo("monitor")}}},[e._v("\n        监控可视化\n      ")]),e._v(" "),n("el-button",{on:{click:function(t){return e.routeTo("warning")}}},[e._v("\n        告警分析\n      ")]),e._v(" "),n("el-button",[e._v("\n        日志管理\n      ")]),e._v(" "),n("el-button",[e._v("\n        推送系统\n      ")]),e._v(" "),n("el-button",{on:{click:function(t){return e.routeTo("config")}}},[e._v("\n        系统配置\n      ")])],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-dropdown",{attrs:{trigger:"hover"}},[n("span",[e._v("\n        username "),n("i",{staticClass:"el-icon-user el-icon--right"})]),e._v(" "),n("el-dropdown-menu",[n("el-dropdown-item",[e._v("\n            aaa\n          ")])],1)],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{staticClass:"hidden-md-and-up",attrs:{span:2}},[n("el-dropdown",{staticClass:"el-dropdown-link",attrs:{trigger:"click"},on:{command:e.routeTo}},[n("el-button",[n("i",{staticClass:"el-icon-menu"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{icon:"el-icon-info",command:"overview"}},[e._v("系统总览")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-video-camera",command:"monitor"}},[e._v("监控可视化")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline",command:"warning"}},[e._v("告警分析")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-notebook-1"}},[e._v("日志管理")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-connection"}},[e._v("推送系统")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-setting",command:"conf"}},[e._v("系统配置")]),e._v(" "),n("el-dropdown-item",{attrs:{icon:"el-icon-switch-button"}},[e._v("退出系统")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var a={name:"App",components:{BaseHeader:n("VU/8")({name:"BaseHeader",data:function(){return{}},methods:{routeTo:function(e){this.$router.push(e)}}},o,!1,function(e){n("+kPp")},null,null).exports}},r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("el-container",{staticStyle:{height:"100%"}},[t("el-header",{staticStyle:{height:"auto"}},[t("base-header")],1),this._v(" "),t("el-main",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[t("router-view")],1)],1)],1)},staticRenderFns:[]};var s=n("VU/8")(a,r,!1,function(e){n("aAyw")},null,null).exports,l=n("/ocq"),c={render:function(){var e=this.$createElement;return(this._self._c||e)("el-card",{style:{background:"rgba(255, 255, 255, "+this.oo+")",padding:this.thePadding}},[this._t("default")],2)},staticRenderFns:[]};var d={name:"Login",components:{BlurCard:n("VU/8")({name:"BlurCard",props:{oo:.3,thePadding:0},data:function(){return{}}},c,!1,function(e){n("Z9P2")},"data-v-63eb8dae",null).exports},data:function(){return{user:"",password:""}},methods:{OnLogin:function(){var e=this;this.$axios.post(this.urlHead+"/api/user/login/",{username:this.user,password:this.password},{withCredentials:!0}).then(function(t){console.log(t),e.$notify({title:"成功",message:t.data,type:"success",duration:2500}),e.$router.push("test")}).catch(function(t){e.$notify({title:"失败",message:t.data,type:"warning",duration:2500})})}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticStyle:{"max-width":"90%"}},[n("h2",[e._v("登录")]),e._v(" "),n("el-form",{attrs:{"label-position":"left"}},[n("el-form-item",{attrs:{label:"用户名"}},[n("el-input",{model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码"}},[n("el-input",{attrs:{"show-password":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.OnLogin}},[e._v("登录")])],1)},staticRenderFns:[]};var h=n("VU/8")(d,u,!1,function(e){n("Isj7")},"data-v-8c8b961e",null).exports,p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"hello"},[n("h1",[e._v(e._s(e.msg))]),e._v(" "),n("h2",[e._v("Essential Links")]),e._v(" "),e._m(0),e._v(" "),n("h2",[e._v("Ecosystem")]),e._v(" "),e._m(1)])},staticRenderFns:[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[n("a",{attrs:{href:"https://vuejs.org",target:"_blank"}},[e._v("\n        Core Docs\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://forum.vuejs.org",target:"_blank"}},[e._v("\n        Forum\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://chat.vuejs.org",target:"_blank"}},[e._v("\n        Community Chat\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://twitter.com/vuejs",target:"_blank"}},[e._v("\n        Twitter\n      ")])]),e._v(" "),n("br"),e._v(" "),n("li",[n("a",{attrs:{href:"http://vuejs-templates.github.io/webpack/",target:"_blank"}},[e._v("\n        Docs for This Template\n      ")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"http://router.vuejs.org/",target:"_blank"}},[this._v("\n        vue-router\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vuex.vuejs.org/",target:"_blank"}},[this._v("\n        vuex\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vue-loader.vuejs.org/",target:"_blank"}},[this._v("\n        vue-loader\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/vuejs/awesome-vue",target:"_blank"}},[this._v("\n        awesome-vue\n      ")])])])}]};var g=n("VU/8")({name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App"}}},p,!1,function(e){n("1uuo")},"data-v-d8ec41bc",null).exports,v=n("yenk"),f=n.n(v),m=n("jkKj"),y=n.n(m),_=n("XLwt"),w={name:"Overview",data:function(){return{drawer:!1,device:[],messages:[{id:1,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428914.6071951.jpg",device_number:1,device_hint:"n3",deal:!0,c_time:"2019-06-26"},{id:2,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428914.6071951.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:3,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428915.6183162.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:4,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428921.801521.jpg",device_number:1,device_hint:"n3",deal:!0,c_time:"2019-06-26"},{id:5,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428922.8135169.jpg",device_number:1,device_hint:"n3",deal:!0,c_time:"2019-06-26"},{id:6,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:7,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428923.8265727.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:8,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428924.8973463.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:9,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428925.974638.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"},{id:10,content:"这是一条告警信息",img_url:"http://188.131.241.21/static/untrack/1558428928.0553596.jpg",device_number:1,device_hint:"n3",deal:!1,c_time:"2019-06-26"}],deviceOnShow:{serial_number:void 0,hint:void 0,location_x:void 0,location_y:void 0,video_url:void 0},videoOnShow:"",autoPlay:!0,messageUnread:0,messageAmount:0,deviceOnline:0,deviceAmount:0}},mounted:function(){var e=this,t=_.init(document.getElementById("voltage-chart")),n=_.init(document.getElementById("install-chart")),i=_.init(document.getElementById("wheather-chart")),o={optical:.5,title:{},tooltip:{trigger:"item",formatter:"{a}  --- {b} : {c} ({d}%)"},visualMap:{show:!1,min:80,max:600,inRange:{colorLightness:[0,1]}},series:[{name:"设备数量",type:"pie",radius:["55%","10%"],minAngle:3,center:["50%","50%"],data:[{value:335,name:"在线"},{value:0,name:"离线"}].sort(function(e,t){return e.value-t.value}),label:{normal:{textStyle:{color:"rgba(255, 255, 255, 0.3)"}}},labelLine:{normal:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:20,length2:50}},itemStyle:{normal:{color:"rgba(48, 228, 183,0.2)",shadowBlur:200,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};t.setOption({title:{},tooltip:{},legend:{data:["用户来源"]},xAxis:{data:["110","110kV","220kV"]},yAxis:{name:"Amount"},series:[{name:"设备数量",type:"bar",data:[22,3,16],itemStyle:{color:"rgb(9, 38, 78)",barBorderRadius:[5,5,0,0],opacity:.5},labelLine:{normal:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:10,length2:20}}}],barWidth:30}),n.setOption(o),i.setOption({tooltip:{},legend:{data:["此刻 ( Present )","昨天 ( Yesterday )"]},radar:{radius:"70%",name:{textStyle:{color:"#fff",backgroundColor:"#999",borderRadius:3,padding:[3,5]}},indicator:[{name:"风向",max:360},{name:"雨量",max:50},{name:"风速",max:10},{name:"气压",max:1500}]},series:[{name:"昨日 vs 此刻（Yesterday vs At present）",type:"radar",data:[{value:[15,1.1,.5,1230],name:"此刻 ( Present )"},{value:[285,10,.7,1300],name:"昨天 ( Yesterday )"}]}]}),window.onresize=function(){t.resize(),n.resize(),i.resize()},this.$refs["popover-message"].doClose();var a=new y.a.Map("map-chart"),r=new y.a.Point(120.697792,36.369133);a.centerAndZoom(r,15),this.$axios.get(this.urlHead+"/api/devices/all").catch(function(){e.$notify({message:"无法获取设备信息",type:"warning"})}).then(function(t){e.device=t.data.data,console.log(t),e.deviceAmount=e.device.length,e.deviceOnline=e.device.length;for(var n=function(t){var n=new y.a.Point(e.device[t].location_x,e.device[t].location_y),i=new y.a.Marker(n);a.addOverlay(i),i.addEventListener("mouseover",function(){e.deviceOnShow=e.device[t],e.$refs["popover-message"].doShow(),console.log(e.$refs["popover-message"])}),i.addEventListener("mouseout",function(){e.$refs["popover-message"].doClose()}),i.addEventListener("click",function(){e.ShowVideo(e.device[t].video_url)})},i=0;i<e.device.length;i++)n(i)}),this.GetMessages(),this.GetMessageInfo()},methods:{MessageFormat:function(e){return 0===e?"无":e+"%"},ShowVideo:function(e){this.drawer=!0,this.videoOnShow=e},InitVideo:function(){var e=document.getElementById("myPlayer"),t=document.createElement("source"),n=document.getElementsByClassName("el-drawer__body")[0];t.setAttribute("src",this.videoOnShow),e.appendChild(t);var i=new f.a.EZUIPlayer("myPlayer");console.log("im here"),i.play(),console.log(i),console.log(this.$refs.videoDrawer),i.opt.height=n.clientHeight,i.opt.width=n.clientWidth},GetMessageInfo:function(){var e=this;this.$axios.get(this.urlHead+"/api/messages/info/").then(function(t){0===t.data.code?(e.messageAmount=t.data.data.total,e.messageUnread=t.data.data.unread):e.$notify({message:t.data.msg,type:"warning"})}).catch(function(t){console.log(t),e.$notify({message:"获取报警信息详情失败",type:"warning"})})},GetMessages:function(){var e=this;this.$axios.get(this.urlHead+"/api/messages/?limit=10&type=all").then(function(t){console.log(t.data),0===t.data.code?e.messages=t.data.data:e.$notify({message:t.data.msg,type:"warning"})}).catch(function(t){console.log(t),e.$notify({message:"无法获取报警信息",type:"warning"})})},HandleChange:function(e,t){this.$refs.imgCarousel.setActiveItem(e),this.$refs.messageCarousel.setActiveItem(e)}},computed:{devicePercentage:function(){return 0===this.deviceAmount?0:Math.ceil(100*this.deviceOnline/this.deviceAmount)},messagePercentage:function(){return 0===this.messageAmount?0:Math.ceil(100*this.messageUnread/this.messageAmount)}}},S={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"overview-main"},[n("el-card",{staticClass:"overview-voltage-card",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("设备安装")]),e._v(" "),n("div",{staticStyle:{height:"100%"},attrs:{id:"voltage-chart"}})]),e._v(" "),n("el-card",{staticClass:"overview-install-card",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("设备在线")]),e._v(" "),n("div",{attrs:{id:"install-chart"}})]),e._v(" "),n("el-card",{staticClass:"overview-map-card",staticStyle:{margin:"0",padding:"0"}},[n("el-popover",{ref:"popover-message",attrs:{trigger:"manual"}},[n("el-card",[n("h4",[e._v("设备序列号")]),e._v("\n        "+e._s(e.deviceOnShow.serial_number)+"\n        "),n("h4",[e._v("提示信息")]),e._v("\n        "+e._s(e.deviceOnShow.hint)+"\n        "),n("h4",[e._v("视频地址")]),e._v("\n        "+e._s(e.deviceOnShow.video_url)+"\n        "),n("h4",[e._v("经纬度")]),e._v("\n        ("+e._s(e.deviceOnShow.location_x)+", "+e._s(e.deviceOnShow.location_y)+")\n      ")]),e._v(" "),n("div",{attrs:{slot:"reference",id:"map-chart"},slot:"reference"})],1)],1),e._v(" "),n("el-card",{staticClass:"overview-amount-card",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("装置数量")]),e._v(" "),n("div",{staticClass:"flex-center",attrs:{id:"amount-chart"}},[n("div",{staticStyle:{display:"block","align-items":"center",height:"auto"}},[n("div",{staticStyle:{display:"block","align-items":"center",height:"auto"}},[n("h4",[e._v("未读消息: "+e._s(e.messageUnread))]),e._v(" "),n("el-progress",{staticStyle:{height:"auto"},attrs:{percentage:e.messagePercentage,format:e.MessageFormat,color:"red"}})],1),e._v(" "),n("div",{staticStyle:{display:"block","align-items":"center",height:"auto"}},[n("h4",[e._v("设备在线: "+e._s(e.deviceOnline))]),e._v(" "),n("el-progress",{staticStyle:{height:"auto"},attrs:{percentage:e.devicePercentage,color:"green"}})],1)])])]),e._v(" "),n("el-card",{staticClass:"overview-wheather-card",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("微气象")]),e._v(" "),n("div",{attrs:{id:"wheather-chart"}})]),e._v(" "),n("el-card",{staticClass:"overview-message-card",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("报警信息")]),e._v(" "),n("el-carousel",{ref:"messageCarousel",attrs:{height:"30%",autoplay:!1,type:"card",direction:"vertical","indicator-position":"outside"},on:{change:e.HandleChange}},e._l(e.messages,function(t){return n("el-carousel-item",{key:t.id,staticClass:"flex-center"},[e._v("\n        "+e._s(t.content)+"\n        "),n("span",{staticStyle:{"font-size":"13px"}},[e._v(e._s(t.c_time))])])}),1)],1),e._v(" "),n("el-card",{staticClass:"overview-img-card"},[n("span",[e._v("预警图片")]),e._v(" "),n("el-carousel",{ref:"imgCarousel",staticStyle:{"align-items":"center"},attrs:{autoplay:e.autoPlay},on:{change:e.HandleChange}},e._l(e.messages,function(e){return n("el-carousel-item",{key:e.id,staticClass:"flex-cente r"},[n("el-image",{staticStyle:{"max-height":"80%"},attrs:{src:e.img_url,fit:"cover"}})],1)}),1)],1),e._v(" "),n("el-drawer",{ref:"videoDrawer",attrs:{title:"设备实时监控",visible:e.drawer,size:"85%","destroy-on-close":!0,direction:"btt"},on:{"update:visible":function(t){e.drawer=t},opened:e.InitVideo}},[n("video",{attrs:{id:"myPlayer",controls:"",playsInline:"","webkit-playsinline":""}})])],1)},staticRenderFns:[]};var b=n("VU/8")(w,S,!1,function(e){n("6Sxf")},"data-v-af0880a8",null).exports,E={name:"Monitor",data:function(){return{videos:[]}},mounted:function(){var e=new f.a.EZUIPlayer("myPlayer");console.log(e)}},k={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{height:"100%",width:"100%"}},[t("el-row",[t("el-col",{attrs:{span:4}},[t("video",{ref:"video",attrs:{id:"myPlayer",controls:"",playsinline:"","webkit-playsinline":"",autoplay:"",height:"300",width:"300",src:"rtmp://rtmp01open.ys7.com/openlive/dcc39c775b5945028a69b4b6953f4369"}})]),this._v(" "),t("el-col",{attrs:{span:20}},[this._v("\n      2\n    ")])],1)],1)},staticRenderFns:[]};var P=n("VU/8")(E,k,!1,function(e){n("mypY")},"data-v-f13309aa",null).exports,C={name:"Warning",data:function(){return{currentPage:1,messagePerPage:10,messages:[],messagesSelected:[],devices:[],dateRange:"",selectDeviceId:"",approvalStatus:"",cellStyle:{justifyItems:"center"},isLoading:!0}},methods:{handleCurrentChange:function(e){console.log("This is current change"),this.currentPage=e},handleSelectionChange:function(e){this.messagesSelected=e},handleCellClick:function(e){this.$refs.multipleTable.toggleRowSelection(e)},handleProve:function(e){for(var t=this,n=[],i=0;i<this.messagesSelected.length;i++)n.push(this.messagesSelected[i].id);this.$axios.post(this.urlHead+"/api/messages/approve",{params:{message_ids:n,approve_status:e}}).then(function(e){0===e.data.code?(t.$notify({message:"审核成功",type:"success"}),t.messagesSelected.forEach(function(e){e.deal=!0})):t.$notify({message:"审核失败"+e.data.msg,type:"danger"})}).catch(function(){t.$notify({message:"请求错误",type:"danger"})})}},computed:{filterMessage:function(){var e=this,t=[];return this.messages.forEach(function(n){console.log(e.dateRange),e.dateRange&&(e.dateRange[0]>n.c_time||n.c_time>e.dateRange[1])||e.selectDeviceId&&e.selectDeviceId!==n.device_number||e.approvalStatus&&e.approvalStatus!==n.deal||t.push(n)}),t},messageDisplayed:function(){return this.filterMessage.slice((this.currentPage-1)*this.messagePerPage,this.currentPage*this.messagePerPage)},pageNumber:function(){return Math.ceil(this.filterMessage.length/this.messagePerPage)}},mounted:function(){var e=this;this.$axios.get(this.urlHead+"/api/messages/").then(function(t){e.isLoading=!1,e.messages=t.data.data}).catch(function(t){e.isLoading=!1,e.$notify({message:"获取数据失败: \n "+t.data.msg,type:"danger"})}),this.$axios.get(this.urlHead+"/api/devices/all").then(function(t){e.isLoading=!1,e.devices=t.data.data}).catch(function(t){e.isLoading=!1,e.$notify({message:"获取设备列表失败 \n "+t.data.msg,type:"danger"})})}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"warning-main"},[n("el-card",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.isLoading,expression:"isLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"warning-table-container",attrs:{"body-style":"{height:'80%'}"}},[n("el-table",{ref:"multipleTable",staticStyle:{width:"100%",height:"100%"},attrs:{data:e.messageDisplayed,"max-height":"95%","cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{prop:"c_time",align:"center","header-align":"center",width:"370"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-date-picker",{attrs:{type:"daterange","unlink-panels":"","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"content",label:"预警详情","header-align":"center",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"device_number",align:"center","header-align":"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-select",{attrs:{placeholder:"设备ID",clearable:!0},model:{value:e.selectDeviceId,callback:function(t){e.selectDeviceId=t},expression:"selectDeviceId"}},e._l(e.devices,function(e){return n("el-option",{key:e.id,attrs:{label:e.id,value:e.id}})}),1)]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"device_hint",label:"设备标识",align:"center","header-align":"center"}}),e._v(" "),n("el-table-column",{attrs:{align:"center","header-align":"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-select",{attrs:{placeholder:"审核状态",clearable:!0},model:{value:e.approvalStatus,callback:function(t){e.approvalStatus=t},expression:"approvalStatus"}},[n("el-option",{attrs:{label:"已审核",value:!0}}),e._v(" "),n("el-option",{attrs:{label:"未审核",value:!1}})],1)]}},{key:"default",fn:function(t){return[t.row.deal?n("el-tag",{attrs:{type:"success"}},[e._v("已审核")]):n("el-tag",{attrs:{type:"danger"}},[e._v("未审核")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"告警图片",align:"center","header-aligh":"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("el-image",{attrs:{src:e.row.img_url}})]}}])})],1),e._v(" "),n("el-row",[n("el-col",{attrs:{align:"middle"}},[n("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.currentPage,total:e.filterMessage.length,"page-size":e.messagePerPage},on:{"current-change":e.handleCurrentChange,"prev-click":e.handleCurrentChange,"next-click":e.handleCurrentChange}})],1),e._v(" "),n("el-col",{attrs:{align:"right"}},[n("el-button",{attrs:{type:"success",disabled:0===e.messagesSelected.length},on:{click:function(t){return e.handleProve(!0)}}},[e._v("\n        预警正确\n      ")]),e._v(" "),n("el-button",{attrs:{type:"danger",disabled:0===e.messagesSelected.length},on:{click:function(t){return e.handleProve(!1)}}},[e._v("\n        预警错误\n      ")])],1)],1)],1)],1)},staticRenderFns:[]};var j=n("VU/8")(C,x,!1,function(e){n("WqBe")},"data-v-33d0c632",null).exports;i.default.use(l.a);var O=new l.a({routes:[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:h},{path:"/test",name:"Test",component:g},{path:"/monitor",name:"Monitor",component:P},{path:"/overview",name:"Overview",component:b},{path:"/warning",name:"Warning",component:j}]}),T=n("mtWM"),M=n.n(T),R=n("zL8q"),A=n.n(R);n("tvR6"),n("sfy8"),n("rqsT");i.default.use(A.a),i.default.prototype.$axios=M.a,i.default.prototype.$axios.defaults.withCredentials=!0,i.default.prototype.urlHead="",O.beforeEach(function(e,t,n){console.log(t.name),console.log(e.name),M.a.get(i.default.prototype.urlHead+"/api/user/check_login/").then(function(t){0===t.data.code?"Login"===e.name?n({path:"overview"}):n():"Login"===e.name?n():n({path:"login"})}).catch(function(){"Login"===e.name?n():n({path:"login"})})}),i.default.config.productionTip=!1,new i.default({el:"#app",router:O,components:{App:s},template:"<App/>"})},WqBe:function(e,t){},Z9P2:function(e,t){},aAyw:function(e,t){},jkKj:function(e,t){e.exports=BMap},mypY:function(e,t){},rqsT:function(e,t){},sfy8:function(e,t){},tvR6:function(e,t){},yenk:function(e,t){!function(t,n){"use strict";console.log("i'm here"),console.log("This is in ezuikit module.export is",e.exports),console.log(t.document),"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("EZUIPlayer requires a window with a document");return n(e)}:(console.log(n),console.log("this is global",t),n(t))}("undefined"!=typeof window?window:this,function(t,n){!function(t,n){function i(){var e=f.elements;return"string"==typeof e?e.split(" "):e}function o(e){var t=v[e[p]];return t||(t={},g++,e[p]=g,v[g]=t),t}function a(e,t,i){return t||(t=n),c?t.createElement(e):(i||(i=o(t)),!(a=i.cache[e]?i.cache[e].cloneNode():h.test(e)?(i.cache[e]=i.createElem(e)).cloneNode():i.createElem(e)).canHaveChildren||u.test(e)||a.tagUrn?a:i.frag.appendChild(a));var a}function r(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return f.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+i().join().replace(/[\w\-:]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(f,t.frag)}function s(e){e||(e=n);var t=o(e);return!f.shivCSS||l||t.hasCSS||(t.hasCSS=!!function(e,t){var n=e.createElement("p"),i=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",i.insertBefore(n.lastChild,i.firstChild)}(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),c||r(e,t),e}var l,c,d=t.html5||{},u=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,h=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",g=0,v={};!function(){try{var e=n.createElement("a");e.innerHTML="<xyz></xyz>",l="hidden"in e,c=1==e.childNodes.length||function(){n.createElement("a");var e=n.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){l=!0,c=!0}}();var f={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:"3.7.3",shivCSS:!1!==d.shivCSS,supportsUnknownElements:c,shivMethods:!1!==d.shivMethods,type:"default",shivDocument:s,createElement:a,createDocumentFragment:function(e,t){if(e||(e=n),c)return e.createDocumentFragment();for(var a=(t=t||o(e)).frag.cloneNode(),r=0,s=i(),l=s.length;l>r;r++)a.createElement(s[r]);return a},addElements:function(e,t){var n=f.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),f.elements=n+" "+e,s(t)}};t.html5=f,s(n),"object"==typeof e&&e.exports&&(e.exports=f)}(void 0!==t?t:this,document),
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
"document"in self&&("classList"in document.createElement("_")?function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,i=arguments.length;for(n=0;n<i;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():function(e){"use strict";if("Element"in e){var t="classList",n="prototype",i=e.Element[n],o=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[n].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},c=function(e){for(var t=a.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],i=0,o=n.length;i<o;i++)this.push(n[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},d=c[n]=[],u=function(){return new c(this)};if(s[n]=Error[n],d.item=function(e){return this[e]||null},d.contains=function(e){return-1!==l(this,e+="")},d.add=function(){var e,t=arguments,n=0,i=t.length,o=!1;do{e=t[n]+"",-1===l(this,e)&&(this.push(e),o=!0)}while(++n<i);o&&this._updateClassName()},d.remove=function(){var e,t,n=arguments,i=0,o=n.length,a=!1;do{for(e=n[i]+"",t=l(this,e);-1!==t;)this.splice(t,1),a=!0,t=l(this,e)}while(++i<o);a&&this._updateClassName()},d.toggle=function(e,t){e+="";var n=this.contains(e),i=n?!0!==t&&"remove":!1!==t&&"add";return i&&this[i](e),!0===t||!1===t?t:!n},d.toString=function(){return this.join(" ")},o.defineProperty){var h={get:u,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,h)}catch(e){-2146823252===e.number&&(h.enumerable=!1,o.defineProperty(i,t,h))}}else o[n].__defineGetter__&&i.__defineGetter__(t,u)}}(self)),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};var o="https://open.ys7.com",a="https://log.ys7.com/statistics.do",r=o+"/sdk/js/2.0/js/ckplayer/ckplayer.js",s=o+"/sdk/js/2.0/js/flv.min.js",l="https:"===t.location.protocol,c=!!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|ios|SymbianOS)/i),d=document.createElement("video"),u=!!d.canPlayType&&!!t.addEventListener,h=u&&d.canPlayType("application/vnd.apple.mpegURL");function p(e){var n={Ver:"v.2.3.0",PlatAddr:t.location.protocol+"//"+t.location.host,ExterVer:"Ez.2.3.0",CltType:102,StartTime:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),OS:navigator.platform};for(var i in e)n[i]=e[i];var o=[];for(var r in n)o.push(r+"="+n[r]);var s="?"+o.join("&");(new Image).src=a+s}p({systemName:"open_netstream_localinfo"});var g=/^rtmp/;function v(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.onload=t,document.getElementsByTagName("head")[0].appendChild(n)}function f(e,t,n,o,a,r){var s=e,l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var e=JSON.parse(l.responseText);a(e)}},l.open(t,s,!0);var c=new FormData;for(i in n)c.append(i,n[i]);l.send(c)}function m(e,t){var n=new RegExp("(\\?|#|&)"+e+"=(.*?)(#|&|$)"),i=(t||location.href).match(n);return decodeURIComponent(i?i[2]:"")}function y(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}var _=function(e){if(!u)throw new Error("不支持ie8等低版本浏览器");if(this.opt={},this.opt.sources=[],this.handlers={},"object"==typeof e&&e.decoderPath){if("string"!=typeof e.decoderPath||void 0===e.decoderPath)throw new Error("EZUIDecoder requires the path of decoder");if("string"!=typeof e.id||void 0===e.id)throw new Error("EZUIDecoder requires parameter id");if("string"!=typeof e.url||void 0===e.url)throw new Error("EZUIDecoder requires parameter url");this.opt.sources.push(e.url),this.opt.currentSource=this.opt.sources[0];if(e.env)e.env.domain;this.jSPlugin={};var n=this,i=this.getRealUrl(e);y(i)&&i.then(function(){var t=n.initDecoder(e);y(t)&&!1!==e.autoplay&&t.then(function(){n.play({handleError:e.handleError})})}).catch(function(t){var i=n.initDecoder(e);y(i)&&!1!==e.autoplay&&i.then(function(){})})}else{var o="";if("string"==typeof e?o=e:"object"==typeof e&&(o=e.id),this.videoId=o,this.video=document.getElementById(o),!this.video)throw new Error("EZUIPlayer requires parameter videoId");var a=this.video.getElementsByTagName("source");a=Array.prototype.slice.call(a,0),this.video.src&&(c&&g.test(this.video.src)?(this.video.removeAttribute("src"),this.video.load()):this.opt.sources.push(this.video.src));var r=a.length;if(r>0)for(var s=0;s<r;s++)c&&g.test(a[s].src)?this.video.removeChild(a[s]):this.opt.sources.push(a[s].src);if(this.opt.sources.length<1)throw new Error("no source found in video tag.");this.opt.cur=0,this.opt.poster=this.video.poster;var l=(v=this.video,t.getComputedStyle?t.getComputedStyle(v,null):v.currentStyle),d=this.video.width,h=this.video.height;d?(this.opt.width=d,this.opt.height=h||"auto",this.log("video width:"+this.opt.width+" height:"+this.opt.height)):(this.opt.width=l.width,this.opt.height=l.height,this.log("videoStyle.width:"+l.width+" wideoStyle.height:"+l.height)),this.opt.parentId=o,this.opt.autoplay=!!this.video.autoplay,this.log("autoplay:"+this.video.autoplay),this.opt.currentSource=this.opt.sources[this.opt.cur],this.getRealUrl(e)}var v;this.handlers={},this.initTime=(new Date).getTime(),this.on("play",function(){p({systemName:"open_netstream_play_main",playurl:this.opt.currentSource,Time:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),Enc:0,PlTp:1,Via:2,ErrCd:0,Cost:(new Date).getTime()-this.initTime})}),this.retry=2,this.on("error",function(){p({systemName:"open_netstream_play_main",playurl:this.opt.currentSource,cost:-1,ErrCd:-1})})};_.prototype.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t))},_.prototype.emit=function(){if(this.handlers[arguments[0]]instanceof Array)for(var e=this.handlers[arguments[0]],t=e.length,n=0;n<t;n++)e[n].apply(this,Array.prototype.slice.call(arguments,1))},_.prototype.getRealUrl=function(e){var n=this,i="https://open.ys7.com";if(e&&e.env&&(i=e.env.domain),e&&e.decoderPath){var o=[],a=o=>new Promise((a,r)=>(function(o,a,r){var s="";if(/^ezopen:\/\//.test(r)){var c=i+"/jssdk/ezopen/getStreamToken?accessToken="+e.accessToken+"&num=10&type="+(-1!==e.url.indexOf("live")?"live":"playback"),d=function(e){if(0!==e.retcode)throw o("get realURL error"),new Error("获取播放token失败");s=s+e.data.params+"&ssn="+e.data.tokens[0],o(s)},u=i+"/api/lapp/live/url/ezopen",h="false";h=e&&e.env&&e.env.domain?-1!==e.env.domain.indexOf("https")?"false":"true":-1!==t.location.href.indexOf("https")?"false":"true",f(u,"POST",{ezopen:r,userAgent:t.navigator.userAgent,isFlv:!1,addressTypes:null,isHttp:h,accessToken:e.accessToken},0,function(e){if(200==e.code||0==e.retcode){var t=m("checkCode",e.data);if(t&&(n.opt.validateCode=t),s+=e.data,-1!==e.data.indexOf("playback")){if(m("begin",e.data))s=s.replace("&begin="+m("begin",e.data),"&begin="+l(m("begin",e.data),"000000"));else{var i=new Date;s=s+"&begin="+i.Format("yyyyMMdd")+"T000000Z"}m("end",e.data)?s=s.replace("&end="+m("end",e.data),"&end="+l(m("end",e.data),"235959")):(i=new Date,s=s+"&end="+i.Format("yyyyMMdd")+"T235959Z"),m("stream",e.data)||(s=s.replace("stream","&stream"))}f(c,"GET","",0,d)}else o("get realURL error")})}else o(r)})(a,0,o));return e.url.split(",").map(function(e,t){o.push(a(e))}),Promise.all(o).then(function(e){n.opt.sources=e,n.opt.currentSource=e[0]}).catch(function(e){})}if(this.opt.currentSource){if(/^ezopen:\/\//.test(this.opt.currentSource)){if(!/^ezopen:\/\//.test(this.opt.currentSource))throw new Error("EZOPEN地址必须要以ezopen://开头");if(-1===this.opt.currentSource.indexOf(".com/"))throw new Error("EZOPEN地址格式不正确");if(!/[a-z\d]{32}(\.hd)?\.live/.test(this.opt.currentSource))throw new Error("EZOPEN地址格式uuid格式不正确");if(/(.*.hls.*|.*.m3u8.*|.*.wss.*|.*.flv.*|.*.rtmp.*){2,}/.test(this.opt.currentSource))throw new Error("EZOPEN地址多于两个播放协议");if(-1!==this.opt.currentSource.search(/(.hls|.m3u8|.wss|.flv|.rtmp)/)&&!/.live(.hls|.m3u8|.wss|.flv|.rtmp)/.test(this.opt.currentSource))throw new Error("请指定正确的播放协议");if(-1===this.opt.currentSource.search(/(.hls|.m3u8|.wss|.flv|.rtmp)/)&&!/[a-z\d]{32}(\.hd)?\.live$/.test(this.opt.currentSource))throw new Error("EZOPEN地址结尾不正确");var r=this;v(s,function(){var e={ezopen:r.opt.currentSource,userAgent:t.navigator.userAgent,isFlv:!(!flvjs||!flvjs.isSupported())&&flvjs.isSupported(),addressTypes:"HLS,RTMP,WS,FLV",isHttp:!(t.location.protocol.indexOf("s")>0)};p({ezopen:r.opt.currentSource,userAgent:t.navigator.userAgent,isFlv:!(!flvjs||!flvjs.isSupported())&&flvjs.isSupported(),addressTypes:"HLS,RTMP,WS,FLV",isHttp:!(t.location.protocol.indexOf("s")>0),systemName:"EZOPEN"}),r.log("---------------------------------------"),r.log("入参(ezopen)是：   "+e.ezopen),r.log("---------------------------------------"),r.log("入参(userAgent)是：   "+e.userAgent),r.log("---------------------------------------"),r.log("入参(isFlv)是：   "+e.isFlv),r.log("---------------------------------------"),r.log("入参(addressTypes)是：   "+e.addressTypes),r.log("---------------------------------------"),r.log("入参(isHttp)是：   "+e.isHttp),r.log("---------------------------------------");f(i+"/api/lapp/live/url/ezopen","POST",e,0,function(e){if(200!=e.code)throw console.log("平台获取播放地址错误"),r.log("data：   "+JSON.stringify(e)),new Error(e.msg);r.log("播放地址是：   "+e.data),r.video.src=e.data,r.video.load(),r.tryPlay(e.data)})})}else this.tryPlay(this.opt.currentSource)}else this.log("未找到合适的播放URL");function l(e,t){if(/^[0-9]{8}T[0-9]{6}Z$/.test(e))return e;if(/[0-9]{8,14}/.test(e)){var n=6-(14-e.length),i=t.length,o=e+t.substring(n,i);return o.slice(0,8)+"T"+o.slice(8)+"Z"}throw new Error("回放时间格式有误，请确认")}},_.prototype.tryPlay=function(e){this.log("开始尝试播放，播放配置参数为："),this.log(e);var t;if(e&&"object"==typeof e&&e.decoderPath);else{this.opt.currentSource=e;var n=this;if(/\.m3u8/.test(e))if(c||h)this.log("使用原生video"),this.video.style.heght=this.opt.height=9*Number(this.opt.width.replace(/px$/g,""))/16+"px",this.initVideoEvent();else{var i=-1!==e.indexOf("https");l&&!i?v(r,function(){n.initCKPlayer()}):v("https://open.ys7.com/sdk/js/2.0/js/hls.min.js",function(){Hls.isSupported()?(n.log("使用hls.js"),n.initHLS(e)):(!0,n.log("2 使用flash"),v(r,function(){n.initCKPlayer()}))})}else if(/^rtmp:/.test(e)){if(c)return this.opt.cur++,void this.tryPlay(e);v(r,function(){n.initCKPlayer(e)})}else if(/^wss:|^ws:/.test(e)){if((t=navigator.userAgent).indexOf("compatible")>-1&&t.indexOf("MSIE")>-1)return void alert("WS协议不支持Ie11以下的浏览器！请使用IE11，或者更高版本的浏览器");v("https://open.ys7.com/sdk/js/2.0/js/jsmpeg.min.js",function(){n.initJSmpeg(e)})}else/\.flv/.test(this.opt.currentSource)&&v(s,function(){n.log("使用flv.js播放"),n.initflv()})}},_.prototype.initHLS=function(e){var t=this,n=new Hls({defaultAudioCodec:"mp4a.40.2"});n.loadSource(e),n.attachMedia(this.video),n.on(Hls.Events.MANIFEST_PARSED,function(){t.opt.autoplay&&t.video.play(),t.initVideoEvent()}),n.on(Hls.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover"),n.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover"),n.recoverMediaError();break;default:n.destroy()}}),this.hls=n},_.prototype.log=function(e){this.emit("log",e)},_.prototype.initCKPlayer=function(e){this.log("ckplayer初始化");var n=this,i={play:function(){n.emit("play")},pause:function(){n.emit("pause")},error:function(){n.emit("error")}};t.ckplayer_status=function(){n.log(arguments),i[arguments[0]]&&i[arguments[0]]()},this.videoFlash=document.createElement("DIV"),this.video.parentNode.replaceChild(this.videoFlash,this.video),this.video=this.videoFlash,this.videoFlash.id=this.opt.parentId;var o=null;o=/^rtmp/.test(this.opt.currentSource)?{f:this.opt.currentSource,c:0,p:this.opt.autoplay?1:0,i:this.opt.poster,lv:1,loaded:"loadHandler"}:/\.m3u8/.test(this.opt.currentSource)?{s:4,f:"https://open.ys7.com/sdk/js/2.0/js/ckplayer/m3u8.swf",a:this.opt.currentSource,c:0,lv:1,p:this.opt.autoplay?1:0,i:this.opt.poster,loaded:"loadHandler"}:{f:this.opt.currentSource,c:0,p:1,loaded:"loadHandler"};this.flashId=this.opt.parentId+"flashId",t.CKobject.embedSWF("https://open.ys7.com/sdk/js/2.0/js/ckplayer/ckplayer.swf",this.opt.parentId,this.flashId,this.opt.width,this.opt.height,o,{bgcolor:"#FFF",allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"})},_.prototype.initVideoEvent=function(){var e,t,n,i,o=this,a={loadstart:function(e){o.log("loadstart...当浏览器开始查找音频/视频时..."),o.emit("loadstart",e)},durationchange:function(e){o.log("durationchange...当音频/视频的时长已更改时..."),o.emit("durationchange",e)},loadedmetadata:function(e){o.log("loadedmetadata...当浏览器已加载音频/视频的元数据时..."),o.emit("loadedmetadata",e)},loadeddata:function(e){o.log("loadeddata...当浏览器已加载音频/视频的当前帧时..."),o.emit("loadeddata",e)},progress:function(e){o.log("progress...当浏览器正在下载音频/视频时..."),o.emit("progress",e)},canplay:function(e){o.log("canplay...当浏览器可以播放音频/视频时..."),o.emit("canplay",e)},canplaythrough:function(e){o.log("canplaythrough...当浏览器可在不因缓冲而停顿的情况下进行播放时..."),o.emit("canplaythrough",e)},abort:function(e){o.log("abort...当音频/视频的加载已放弃时..."),o.emit("abort",e)},emptied:function(e){o.log("emptied...当目前的播放列表为空时..."),o.emit("emptied",e)},ended:function(e){o.log("ended...当目前的播放列表已结束时..."),o.emit("ended",e)},pause:function(e){o.log("pause...当音频/视频已暂停时..."),o.emit("pause",e)},play:function(e){o.log("play...当音频/视频已开始或不再暂停时..."),o.emit("play",e)},playing:function(e){o.log("playing...当音频/视频在已因缓冲而暂停或停止后已就绪时..."),o.emit("playing",e)},ratechange:function(e){o.log("ratechange...当音频/视频的播放速度已更改时..."),o.emit("ratechange",e)},seeked:function(e){o.log("seeked...当用户已移动/跳跃到音频/视频中的新位置时..."),o.emit("seeked",e)},seeking:function(e){o.log("seeking...当用户开始移动/跳跃到音频/视频中的新位置时..."),o.emit("seeking",e)},stalled:function(e){o.log("stalled...当浏览器尝试获取媒体数据，但数据不可用时..."),o.emit("stalled",e)},suspend:function(e){o.log("suspend...当浏览器刻意不获取媒体数据时..."),o.emit("suspend",e),o.opt.autoplay&&o.video.play()},timeupdate:function(e){o.emit("timeupdate",e)},volumechange:function(e){o.log("volumechange...当音量已更改时..."),o.emit("volumechange",e)},waiting:function(e){o.log("waiting...当视频由于需要缓冲下一帧而停止..."),o.emit("waiting",e)},error:function(e){o.log("error...当在音频/视频加载期间发生错误时..."),o.emit("error",e)}};for(var r in a)this.video.addEventListener(r,a[r],!1);e=this.video,t=!1,n=!1,i=0,e.addEventListener("loadeddata",function(){t=!0},!1),e.addEventListener("stalled",function(){i++,n||i>=2&&!t&&(e.load(),e.play(),t=!1,n=!1,i=0)},!1),e.addEventListener("playing",function(){n=!0})},_.prototype.initJSmpeg=function(e){var t;this.canvasEle=document.createElement("canvas"),this.canvasEle.style.width=this.opt.width,this.canvasEle.style.height=this.opt.height,this.video.parentNode.replaceChild(this.canvasEle,this.video),this.canvasEle.id=this.opt.parentId,t&&t.destroy&&t.destroy(),t=new JSMpeg.Player(e,{canvas:this.canvasEle}),this.JSmpeg=t},_.prototype.initflv=function(){if(!flvjs.isSupported())throw this.log("浏览器不支持flv播放"),new Error("浏览器不支持flv播放");var e=this.video;e.getAttribute("controls")||e.setAttribute("controls",!0);var t=flvjs.createPlayer({type:"flv",url:this.opt.currentSource,isLive:!0},{enableStashBuffer:!0,stashInitialSize:128,enableWorker:!0});t.attachMediaElement(e),t.load(),t.play(),this.flv=t},_.prototype.play=function(e){if(this.log("开始播放"+this.opt.currentSource),t.CKobject)this.opt.autoplay=!0,this.initCKPlayer();else if(this.video)this.hls?(this.opt.autoplay=!0,this.hls.startLoad(),this.video.play()):this.JSmpeg?this.JSmpeg.play():(this.opt.autoplay=!0,this.video.play());else if(this.jSPlugin){var n=this;function i(e){return{websocketConnectUrl:e.split("?")[0].replace("/live","").replace("/playback",""),websocketStreamingParam:(-1===e.indexOf("/live")?"/playback?":"/live?")+e.split("?")[1]}}setTimeout(function(){n.log("默认开启第一路声音"),n.jSPlugin.JS_OpenSound(0)},5e3),e&&void 0!==e.index?e.index.forEach(function(t,o){n.jSPlugin.JS_Play(i(n.opt.sources[t]).websocketConnectUrl,{playURL:i(n.opt.sources[t]).websocketStreamingParam},t).then(function(){console.log("realplay success"),e&&e.handleSuccess&&e.handleSuccess()},function(t){if(console.log("realplay failed",t.oError),e&&e.handleError){var n=t.oError;e.handleError(n)}})}):n.opt.sources.forEach(function(t,o){n.jSPlugin.JS_Play(i(t).websocketConnectUrl,{playURL:i(t).websocketStreamingParam},o).then(function(){console.log("realplay success"),e&&e.handleSuccess&&e.handleSuccess()},function(t){if(console.log("realplay failed",t.oError),e&&e.handleError){var i=JSON.parse(n.errorCode).find(function(e){return e.detailCode.substr(-4)==t.oError.errorCode});e.handleError({retcode:t.oError.errorCode,msg:i?i.description:"其他错误"})}})})}},_.prototype.initDecoder=function(e){this.opt.id=e.id,this.log("初始化解码器---开始");var n=this;return new Promise(function(i,o){function a(e){if(200==e.code){if(!t.localStorage)return!1;var i=t.localStorage;i.errorCode=JSON.stringify(e.data),n.errorCode=i.errorCode}}if(v(e.decoderPath+"/js/jsPlugin-1.2.0_test.js",function(){n.log("下载解码器完成，开始初始化"),n.jSPlugin=new JSPlugin({szId:e.id,iType:1,iWidth:e.width||600,iHeight:e.height||400,iMaxSplit:Math.ceil(Math.sqrt(e.url.split(",").length)),iCurrentSplit:e.splitBasis||Math.ceil(Math.sqrt(e.url.split(",").length)),szBasePath:e.decoderPath+"/js/"}),t.onresize=function(){n.jSPlugin.JS_Resize(e.width||600,e.height||400)},n.log("初始化解码器----完成"),n.log("开始设置秘钥");var o=n.opt.validateCode;o&&n.jSPlugin.JS_SetSecretKey(0,o),i("200 OK")}),t.localStorage){var r=t.localStorage;r.errorCode?n.errorCode=r.errorCode:f(e.decoderPath+"/js/errorCode.json","get",{language:1,time:(new Date).getTime(),appKey:"26810f3acd794862b608b6cfbc32a6b8"},0,a)}else f(e.decoderPath+"/js/errorCode.json","get",{language:1,time:(new Date).getTime(),appKey:"26810f3acd794862b608b6cfbc32a6b8"},0,a)})},_.prototype.stop=function(e){if(this.log("停止播放"+this.opt.currentSource),this.opt.autoplay=!1,t.CKobject)this.video.src="";else if(this.video)this.hls?(this.video.pause(),this.video.src="",this.hls.stopLoad()):this.flv?(this.flv.pause(),this.flv.unload(),this.flv.detachMediaElement(),this.flv.destroy(),this.flv=null):this.JSmpeg&&this.JSmpeg.stop();else if(this.jSPlugin){var n=this;if(void 0===e){var i=this.opt.sources.length;for(index=0;index<i;index++)this.jSPlugin.JS_Stop(index).then(function(){n.log("停止播放成功"+n.opt.currentSource),console.log("stop success")},function(){n.log("停止播放失败"+n.opt.currentSource),console.log("stop failed")}),o(index)}else this.jSPlugin.JS_Stop(e).then(function(){n.log("停止播放成功"+n.opt.currentSource),console.log("stop success")},function(){n.log("停止播放失败"+n.opt.currentSource),console.log("stop failed")}),o(e);function o(e){for(var t=document.getElementById(n.opt.id).childNodes[0].childNodes[e],i=t.childNodes,o=i.length-1;o>=0;o--)t.removeChild(i[o])}}},_.prototype.getOSDTime=function(e,t){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_GetOSDTime(t||0).then(function(t){e(1e3*t)},function(e){console.log("get OSD Time error",e)})},_.prototype.openSound=function(e){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_OpenSound(e||0)},_.prototype.pause=function(){this.opt.autoplay=!1,t.CKobject?CKobject.getObjectById(this.flashId).videoPause():this.video?this.JSmpeg?this.JSmpeg.pause():this.video.pause():this.jSPlugin&&this.jSPlugin.JS_Pause(0).then(function(){},function(){})},_.prototype.load=function(){t.CKobject||this.video&&this.video.load()};var w=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t.AudioContext=t.AudioContext||t.webkitAudioContext},S=function(e){if(e&&"object"!=typeof e)throw new Error("EZUITalk requires parameter it doesn't right");var n,i=e.id,o=e.token,a=e.uuid;if("string"!=typeof i||void 0===i)throw new Error("EZUITalk requires parameter audioId");if(this.audio=document.getElementById(i),!this.audio)throw new Error("EZUITalk requires parameter audioElement");if(!o)throw new Error("EZUITalk requires parameter accessToken");if(!a)throw new Error("EZUITalk requires parameter uuid");if(w(),!navigator.getUserMedia)throw new Error("当前浏览器不支持录音功能");if(!{trident:(n=t.navigator.userAgent).indexOf("Trident")>-1,presto:n.indexOf("Presto")>-1,webKit:n.indexOf("AppleWebKit")>-1,gecko:n.indexOf("Gecko")>-1&&-1===n.indexOf("KHTML"),mobile:!!n.match(/AppleWebKit.*Mobile.*/),ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:n.indexOf("Android")>-1||n.indexOf("Adr")>-1,iPhone:n.indexOf("iPhone")>-1,iPad:n.indexOf("iPad")>-1,webApp:-1==n.indexOf("Safari"),weixin:n.indexOf("MicroMessenger")>-1,qq:" qq"==n.match(/\sQQ/i),ie:n.indexOf("Trident")>-1||n.indexOf("MSIE")>-1||n.indexOf("compatible")>-1}.mobile)throw new Error("对讲功能仅在手机中支持进行对讲");this.handlers={};var r=this;this.BUFFER=[],this.encoder=void 0,this.isEnded=!0,this.LENGTH=20,this.audio.addEventListener("ended",function(){r.isEnded=!0}),this.audioPlay=function(){if(this.isEnded){this.isEnded=!1,this.BUFFER.length>this.LENGTH&&(this.BUFFER=this.BUFFER.slice(0,this.LENGTH)),this.encoder=new WavAudioEncoder(16e3,1);for(var e=this.BUFFER.shift();e;)this.encoder.encode(e),e=this.BUFFER.shift();this.audio.src=URL.createObjectURL(this.encoder.finish())}},this.start=function(){this.wsUrl="wss://test2.ys7.com:20007/opentalk/"+a,this.socket=new WebSocket(this.wsUrl),this.talk()},this.talk=function(){v("https://open.ys7.com/sdk/js/2.0/js/wav-audio-encoder.js",function(){r.socket.onopen=function(){r.log("websocket已连接");var e={accessToken:o,uuid:a},t=JSON.stringify(e);r.socket.send(t),r.log("websocket 发送文本数据"),r.startRecord()},r.socket.onclose=function(){r.log("websocket已关闭")},r.socket.onerror=function(e){r.log("websocket出错->"+JSON.stringify(e))},r.socket.onmessage=function(e){r.log("websocket 接收数据"),r.BUFFER.push(e.data),r.audioPlay()},r.audio.setAttribute("autoplay",!0),r.audio.play()})},this.startRecord=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t=new AudioContext,n=t.createMediaStreamSource(e),i=t.createScriptProcessor(16384,1,1);r.log("当前浏览器采样率为： "+t.sampleRate),i.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);o.postMessage({cmd:"encode",buf:t})};var o=new Worker("../js/worker.js");o.onmessage=function(e){switch(e.data.cmd){case"pcm":r.socket.send(e.data.buf),console.log(e.data.buf),r.log("websocket 发送数据");break;default:r.log("未知信息："+e.data)}},i&&n&&(n.connect(i),i.connect(t.destination)),r.log("开始对讲"),r.stop=function(){i&&n&&(n.disconnect(),i.disconnect()),r.socket.close(),r.log("结束对讲")}}).catch(function(e){var t;switch(e.code||e.name){case"PermissionDeniedError":case"PERMISSION_DENIED":case"NotAllowedError":t="用户拒绝访问麦克风";break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":t="浏览器不支持麦克风";break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":t="找不到麦克风设备";break;default:t="无法打开麦克风，异常信息:"+(e.code||e.name)}r.log(t),alert(t)})}};S.prototype.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t))},S.prototype.emit=function(){if(this.handlers[arguments[0]]instanceof Array)for(var e=this.handlers[arguments[0]],t=e.length,n=0;n<t;n++)e[n].apply(this,Array.prototype.slice.call(arguments,1))},S.prototype.log=function(e){this.emit("log",e)};var b={EZUIPlayer:_,EZUITalk:S};return n||(t.EZUIKit=b,t.EZUIPlayer=_),b})}},["NHnr"]);
//# sourceMappingURL=app.ad029b59c213eb77531d.js.map